---
layout: post
title:  "管理块存储(110-8)"
categories: Linux
tags: RHCA 110
---

### 管理永久块存储

###### 永久卷

块存储（有时称为卷存储）为 OpenStack 实例提供永久块存储。用户通过将卷连接到运行中的实例来与这种块存储交互。由于这些卷是永久的，它们可以从一个实例分离，重新连接到另一个实例上，其数据会保持完好。

在 OpenStack 中，块存储由名为 Cinder 的服务提供，此服务以驱动程序的形式为多种后端提供支持。Red Hat OpenStack Platform 为多种受支持的块存储类型提供卷驱动程序。这些类型包括：

*    iSCSI
*    NFS
*    NetApp NFS
*    Ceph
*    Dell EqualLogic

> 红帽不再支持将 LVM（逻辑卷管理器）用作 Cinder 卷的后端存储。OpenStack Cinder 仍然作为后端存储提供 LVM。

###### 创建卷

创建卷不需要管理特权。需要编辑的字段为：

*    字段 	    描述
*    卷名称 	    卷的名称。
*    描述 	    卷的简短描述。
*    类型 	    在使用多个后端时，代表特定的存储类型。
*    大小 (GB) 	卷的大小（GB 为单位）。
*    可用性区域 	用于存储的主机聚合。

也可以指定卷来源，从现有的快照、映像或卷创建新卷。如果不指定此项，则创建一个不含任何文件系统或分区表的空卷。

如果未定义卷组，则创建环回挂载设备。

###### 删除卷

可以从项目>计算下的卷子选项卡中删除卷。选择需要删除的卷的复选框。单击删除卷并确认选择。在卷被删除时，它将被填充零，并可连接到请求它的其他实例。

在实例被删除时，它所连接的卷中的数据不会被删除。

###### 将卷与实例连接

卷可以连接到运行中的实例。卷的状态可以从控制面板的卷选项卡中查看。卷的状态可以是可用或使用中。

在连接了卷后，用户可以登录实例并挂载、格式化和使用磁盘。

###### 将卷与实例分离

要分离卷，可前往项目>计算选项卡，再单击卷类别。在分离卷时，可单击 Edit Attachments 菜单项，再单击分离卷按钮，然后确认更改。

###### 在实例中使用卷

要使用卷，可登录实例，使用一种文件系统格式化卷，然后挂载卷。可以使用 ext4、xfs 和 zfs 等各种文件系统。如果一个卷同时连接到多个实例，请确保文件系统为只读，或者该文件系统是群集感知型。


### 管理永久块存储快照

###### 永久块存储快照

可以执行卷快照，保留卷在某一时点上的状态。在卷被删除时，可以从快照中恢复卷。

与快照相似，也可为卷执行卷备份。它们之间的区别在于，卷备份保留卷中的数据，以防止数据丢失，而快照则用于促成克隆。

快照也可用于从运行中的实例创建新映像。可以通过这种简单的方式升级基础映像，并向映像中添加自定义；但是，这种方法在处理不含静态数据的实例时会有困难，因为对运行中的实例执行的实例快照可能会导致数据不一致，并且可能无法正常启动或运行相关的服务。在这样的情形中，需要同步和冻结实例文件系统，然后再执行快照，从而获得永久的快照。

###### 创建卷快照

1. 在控制面板中，选择项目和计算下的卷。
2. 选择需要执行快照的卷，再选择 Create Snapshot.
3. 提供快照名称，再单击创建卷快照。

###### 删除卷快照

删除快照：

1. 单击 Delete Volume Snapshot ，其位于要删除的快照的Actions菜单中。

###### 将快照与实例连接

快照出现在卷快照表后，便可从它克隆新的卷。为此，可选择要从中克隆卷的快照，再选择 Create Volume （Actions菜单中）。


### 管理临时存储

###### 临时存储

临时存储可以像块级别存储一样连接到实例，但其数据不是永久的。在它所连接的实例之外，无法保留或引用该磁盘。临时存储由 OpenStack 计算服务 (Nova) 提供，永久块存储则是由 OpenStack 块存储服务 (Cinder) 提供的。

块存储卷是可供实例使用的永久存储，无论运行中的实例是何状态。

###### 使用临时存储创建实例

临时磁盘是其类别的一部分，只能在启动实例时连接。在使用要求高 IOPS、但不在意持久性的应用时，可以使用此存储，因为此存储在生产级部署中可以由 SSD 提供支持，而且对在其中运行实例的系统管理程序而言它是本地的。MongoDB 等 NoSQL 数据库的部署可以使用临时存储完成。这也可用于实例中的交换设备，但实例的根文件系统应当驻留于永久块存储上。


### 验证块存储功能

###### 验证永久存储

当卷由 Cinder 连接到实例时，它可以映射到操作系统管理的其中一个设备。当 Cinder 卷将自身状态改为使用中时，这表明该卷可在已连接的实例中作为裸设备。可对该裸设备进行格式化并挂载到文件系统上。

Cinder 管理的卷其优势之一在于持久性，所以，如果将卷从一个实例分离并连接到另一个实例，文件系统可以正确安装，且不会出现数据丢失。

###### 验证临时磁盘和交换空间

连接到实例的临时存储也会在其已连接的实例操作系统上提供一个裸设备。对 Cinder 卷来说，可对裸设备进行格式化并挂载到实例的文件系统上。

两种存储类型的一项区别在于它们使用的后端存储存不同。临时存储设备基于位于相同目录的虚拟磁盘，支持实例根文件系统的虚拟磁盘也位于此目录，其通常位于已部署实例的计算节点的文件系统中。

默认情况下，当实例部署到计算节点后，Nova 就会在该计算节点的 /var/lib/nova/instances/ 目录创建一个新的子目录。Nova 使用该子目录来保存该实例要使用的所有文件，包括支持其根文件系统的虚拟磁盘和与实例相关联类别中的已配置临时存储。该子目录的名称是相关联实例的 UUID。

交换空间通过与实例相关联的类别配置，并且也是基于该目录中的文件，因此使用相同的后端存储会影响实例的交换内存性能。

### 总结

在本章中，您可以学到：

*    Cinder 在 OpenStack 平台中提供卷服务。
*    块存储提供永久级别的存储，可用于各种后端。
*    快照可用于获取卷的时点状态，可以用于为实例执行快照。
*    临时磁盘是类别的一部分，具有非持久特征，它们会在实例删除时一同删除。
