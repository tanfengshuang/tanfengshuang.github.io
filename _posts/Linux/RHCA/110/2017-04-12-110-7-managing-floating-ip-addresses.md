---
layout: post
title:  "管理浮动 IP 地址(110-7)"
categories: Linux
tags: RHCA 110
---

### 管理浮动 IP 地址

###### 浮动 IP 地址

浮动 IP 用于实现从外部网络到虚拟机实例的通信。浮动 IP 地址只能从现有的浮动 IP 池中分配。浮动 IP 分配池在创建外部子网时定义。浮动 IP 在实例启动后关联，且无论实例状态都可更改。默认情况下，浮动 IP 数的项目限值为 50。浮动 IP 取消关联之后，它就返回到池中，可以重新供其他实例使用。若要从项目中取消分配 IP 地址，该 IP 地址必须在取消关联后释放。一旦浮动 IP 被释放，就不保证能够分配到同一个 IP 地址。

######### 分配浮动 IP 到项目

1. 在控制面板中，选择项目 > 计算 > 访问权限与安全性。
2. 单击分配 IP 至项目。
3. 在池字段中选择一个网络，以便从中分配 IP 地址。
4. 单击分配 IP。

######### 关联浮动 IP

1. 在控制面板中，选择项目 > 计算 > 访问权限与安全性。
2. 单击所需地址的关联按钮。
3. 在 IP 地址字段中选择要分配的地址。如果没有地址可用，可单击 + 按钮创建新地址。
4. 在要关联的端口字段中，选择要关联的实例。
5. 单击关联。

######### 取消关联并释放浮动 IP

1. 在控制面板中，选择项目 > 计算 > 访问权限与安全性。
2. 在浮动 IP 选项卡内，单击取消关联。
3. 单击下拉菜单，然后选择释放浮动 IP。

###### L3 路由和 NAT

网络地址转换 (NAT) 功能由网关端口上的 L3 路由器提供，这些端口将路由器向上链接到外部网络。路由器执行 SNAT，它将从外部网络上的公共 IP 到与路由器连接的子网上的专用 IP 创建一个静态一对一映射。L3 代理使用 iptables 来实施浮动 IP，从而进行网络地址转换。浮动 IP 不与实例直接关联；浮动 IP 关联到的是 Neutron 端口。


### 验证浮动 IP 地址功能 

###### 验证浮动 IP

若要验证浮动 IP 的连通性，最简单也最可靠的一种方法是使用 ping 命令。在使用 ping 进行验证时，务必要考虑所使用的 OpenStack 拓扑。若要充分利用 ping 验证浮动 IP，请从本应与该浮动 IP 连通的任何外部网络执行 ping。确保也能从该实例成功 ping 外部网络上的一个地址。如果 ping 测试不成功，可检查如下所列：

1. 验证使用的安全组允许 SSH 和 ICMP。
2. 通过 ip a 验证公共子网已添加到公共接口。
3. 通过 iptables 验证 NAT 规则已添加到 Neutron 节点上的 iptable。
4. 验证 qrouter 具有 qg 接口。

### 总结

在本章中，您可以学到：

*    浮动 IP 可以直接分配，或者从公共网络的分配池中分配。
*    浮动 IP 地址必须先分配后，才能指派给实例。
*    Open Vswitch 实施隧道网桥 br-tun 来传输 VXLAN 和 GRE 流量。
*    ovs-vsctl show 可用于识别通向 br-int、br-tun 和 br-ex 的连接。
*    ping 命令可用于验证外部网络和浮动 IP 之间的连通性。
