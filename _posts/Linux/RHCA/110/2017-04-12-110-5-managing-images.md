---
layout: post
title:  "管理镜像(110-5)"
categories: Linux
tags: RHCA 110
---

### 管理镜像

###### 镜像

在 Red Hat OpenStack Platform 中，镜像是包含安装了可引导操作系统的虚拟磁盘的文件。此服务由 Glance 提供。这为创建实例组成了最低级的构建块。

这些映像可以由用户上传；下面列出了 RHEL OpenStack 平台上支持的格式：

*    格式 	描述
*    raw 	非结构化磁盘映像格式.
*    vhd 	来自 VMware、Xen、Microsoft、VirtualBox 等供应商的虚拟机显示器使用的一种常见磁盘格式。
*    vmdk 	很多常见虚拟机显示器支持的另一种常见磁盘格式.
*    vdi 	VirtualBox 虚拟机显示器和 QEMU 模拟器支持的磁盘格式.
*    iso 	光盘（例如，CD-ROM）数据内容的存档格式。
*    qcow2 	QEMU 仿真器支持的磁盘格式，可以动态扩展并且支持写时复制功能。
*    aki 	这表明 Glance 中存储的内容是 Amazon 内核映像.
*    ari 	这表明 Glance 中存储的内容是 Amazon ramdisk 映像.
*    ami 	这表明 Glance 中存储的内容是 Amazon 计算机映像.

###### 上传镜像

市面上有多种预先创建的镜像，可以轻松导入到 Glance 存储中。要下载官方的红帽企业 Linux 云镜像，需要具有有效的红帽企业 Linux 订阅。除了预先创建的镜像外，也可以使用 Oz 等工具创建自定义映像。

镜像服务也提供为服务器镜像制作副本或快照的功能，它们可以用作模板来使得新服务器能够快速启动并运行。这有助于维护一致性，也可避免安装服务器操作系统和逐一配置实例上的额外软件。在上传映像时，必须指定容器格式：容器格式指定了映像是否为某一文件格式，其也包含与实际虚拟机相关的元数据。支持的容器格式为：

*    格式 	描述
*    bare 	这表明映像没有容器或元数据包。
*    ovf 	这是 OVF 容器格式。
*    ova 	这表明 Glance 中存储的内容是 OVA tar 存档文件。
*    aki 	这表明 Glance 中存储的内容是 Amazon 内核映像。
*    ari 	这表明 Glance 中存储的内容是 Amazon ramdisk 映像。
*    ami 	这表明 Glance 中存储的内容是 Amazon 计算机映像。

> Glance 和其他 OpenStack 组件目前未使用容器格式字符串，因此如果不确定要使用的格式，那么直接将 bare 指定为容器格式也无妨。

###### 使用 Horizon 上传映像

以下为使用 Horizon 控制面板上传新映像的步骤：

1. 在控制面板中，选择项目 -> 计算 > 映像。
2. 单击创建映像。
3. 填写文本字段，再单击创建映像。

Horizon 中的映像上传字段

*    字段 	            描述
*    名称 	            映像的唯一名称。
*    说明 	            用于标识映像的简短描述。
*    映像来源 	        映像来源可以是映像位置或映像文件。
*    映像位置或映像文件 	指定映像 URL 或本地磁盘中的映像。
*    格式 	            支持的格式（如 qcow2）。
*    架构 	            映像架构。例如，可根据要上传的映像，使用 i686 代表 32 位映像，或使用 x86_64 代表 64 位。
*    最小磁盘 (GB) 	    引导该映像需要的最小磁盘大小。
*    最小 RAM (MB) 	    引导该映像需要的最小内存大小。
*    公共 	            若选中此项，则使得映像成为公共映像，可由有权访问该项目的所有用户访问。
*    受保护 	            若选中此项，可确保只有具备特定权限的用户才能删除此映像。

###### 删除映像

可以使用 Horizon 控制面板永久删除映像。

1. 在控制面板中，导航到Project → Compute → Images.
2. 选择要删除的映像，再单击删除映像。

###### 管理映像限值

使用 Horizon 控制面板更新映像：

1. 在控制面板中，导航到Project → Compute → Images。
2. 单击 Edit Image 。
3. 可以更新最小磁盘、最小 RAM、公共和受保护等字段。完成时，单击更新映像。

> 只有以管理员用户登录时，才可使用编辑映像选项。以非管理员用户身份登录时，可用的选项有启动实例或创建映像。

###### 公共映像和私有映像

公共映像可供有权访问项目的所有用户访问，把它们变为私有映像（取消选中编辑映像对话框中的公共复选框）将使得映像只能由上传了该映像的用户访问。

> 无法通过 Horizon 控制面板在项目之间共享映像。它们可以被设为私有，从映像所上传的项目中访问。共享可以通过使用命令行界面来完成。下一发行版中可能也会在 Horizon 控制面板中提供此功能。

###### 最小磁盘

可以指定最小磁盘大小，以强制实施使用该映像引导实例时的最小磁盘要求。若不指定此字段，则默认值为 0（无最小值）。在安装和配置了需要特定磁盘空间才能执行的软件的用例中，可以使用最小磁盘来根据所选类别强制实施实例的磁盘大小。

###### 最小 RAM

可以指定最小 RAM 大小，以强制实施使用该映像引导实例时的最小内存要求。若不指定此字段，则默认值为 0（无最小值）。在安装的软件或服务要求特定内存大小才能正常工作的用例中，也可以使用此项来强制实施最小内存要求。


### 验证映像功能

###### 验证映像

Red Hat OpenStack Platform 要求映像支持特定的配置（如 cloud-init 支持），以便部署使用这些映像的实例。如果要测试该配置是否已在映像创建时正确设置，最好的方法是部署使用该映像的实例。验证映像设置可能需要其他的配置，例如在与我们用户相关联的项目中配置其他用户，以便测试映像可访问性（公共与专用）。

###### 验证映像限值

实例使用映像作为其虚拟磁盘的模板，并使用相应类别，该类别可定义要部署的实例所要求的资源。如果这些资源不可用，会发出错误消息，实例无法部署。如果这些资源与该类别提供的资源不匹配，则该映像包括可能影响实例部署的其他要求。这些要求包括最小磁盘大小和 RAM 大小。

为了避免实例部署出现问题，实例所使用的类别应规定磁盘和内存大小大于映像所要求的大小。如果使用 CLI，并且映像要求的最低数量与类别所要求的不匹配，则会发出错误消息。在 Horizon 中，当使用控制面板提供的向导来部署实例时，一旦选择了映像，所有与该映像要求的最小磁盘和内存不匹配的类别都会禁用。如果所有定义的类别都与映像要求不匹配，则会显示错误消息。 


### 总结

在本章中，您可以学到：

*    Glance 在 OpenStack 平台中提供镜像服务。
*    镜像是用于启动实例的最低级构建块。
*    镜像服务也提供服务器镜像制作副本或快照的功能，它们可以用作模板来使得新服务器能够快速启动并运行。
*    可以对镜像设置限制，定义启动该镜像的实例所需的最小磁盘和 RAM。
*    为镜像定义的最小磁盘大小和 RAM 应当被所选的类别容纳，从而能启动实例。
*    公共镜像可由所有项目访问，但它们可以被设为私有，将访问限制到从中上传该映像的项目。
