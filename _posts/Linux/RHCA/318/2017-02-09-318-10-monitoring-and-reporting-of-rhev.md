---
layout: post
title:  "Monitoring and Reporting of RHEV(318-10)"
categories: Linux
tags: RHCA 318
---

### 监控 RHEV

###### 使用搜索栏

*    RHEV Manager 的 Web 管理界面拥有一个强大的搜索栏，能够在 RHEV 基础架构中有效查找资源。它支持自由文本搜索和基于正式语法格式的搜索。自动完成功能让不熟悉搜索语法的管理员可以快速构建有效搜索。可为常用搜索添加书签。
*    正式搜索语法带有一个必填字段：搜索结果中将被返回的资源类型。如果未提供任何其他参数，则将返回所有资源。通过匹配一系列搜索条件，可以减少搜索结果，在数百台主机上管理着数千台虚拟客户机的站点上查找一台虚拟机或主机时，该功能很有用。 

搜索栏表达式的语法： Result-type: [Criteria...] [sortby Sort_spec]

Result-type 是一种 RHEV 资源，如 Vms、Datacenter、Hosts、Events、Cluster、Storage 或 Template。

可选的条件是该格式的一种表现形式：属性操作值。

*    属性是所匹配的内容，如机器名称。
*    运算符是比较对象的方式 (= != > < >= <=)。
*    值是要比较的值。

可选的 sortby 指令可与一种排序规格相关联，以根据各种标准对结果进行递增或递减排序。

###### 演示：使用搜索栏

1. 找到当前正在运行的所有 RHEV 系统管理程序主机：    Hosts: status = up
2. 找到当前正在运行且包含 VM 的所有 RHEV 系统管理程序主机：    Hosts: VMs.status = up
3. 找到所有虚拟机：    Vms:
4. 找到所有名称中带有 “rhel” 的虚拟机：    Vms: rhel
5. 找到所有虚拟机并按照正常运行时间递减排列：    Vms: sortby uptime desc
6. 找到所有严重性高于普通的日志事件并按照时间排序：    Events: severity > normal sortby time
7. 常用搜索可以添加为书签。

*    在 RHEV 管理器搜索栏输入搜素。
*    单击搜索栏右侧的星号按钮。
*    输入可清楚说明搜索的名称。
*    书签将显示在主窗格左侧的书签选项卡中。

###### 演示：使用标签

借助标签，能够根据预定义的用户标签搜索主机或虚拟机，并根据特定标签过滤显示。如果存在很多对象，而需要集中显示某个特定集合时，这会特别有用。可以按照一组需求以层次结构形式排列标签。 

1. 创建标签的步骤

*    单击左侧窗格上的标签按钮，以展开标签部分。
*    选择要在其下创建标签的节点。例如，要在最高级别创建标签，则单击根节点。
*    单击标签窗格上的新建按钮。将显示新建标签对话框。
*    输入新标签的名称和描述。
*    单击确定。

2. 编辑标签的步骤

*    单击左侧窗格上的标签选项卡。
*    选择要修改的标签。
*    单击编辑。

3. 删除标签的步骤

*    单击标签选项卡。
*    选择要删除的标签。
*    单击删除。

4. 为对象添加标签

可以将标签附加到主机和虚拟机。要在一个或多个目标上添加标签，请执行下列步骤：

*    搜索要标记的对象。
*    在结果列表上选择目标。
*    单击工具栏上的分配标签按钮。一个对话框提供一个标签列表。
*    选择复选框以将标签分配到目标。
*    单击确定。
    
5. 使用标签搜索对象。 使用标签搜索目标，执行以下步骤：

*    在搜索栏中，以 tag 作为属性、所需值作为搜索条件，输入对象的搜索查询。    Vms: tag = nameoftag
*    以所指定标签条件标记的对象将在结果列表中列出。


### 生成报告

###### 报告引擎

    报告引擎是红帽企业虚拟化管理平台的一个内置报告工具。它由 JasperReports 和 JasperServer 组成，它们都是开源报告工具。JasperReports 生成的报告可以在屏幕上呈现，进行打印，也可以导出至各种格式，包括 PDF、CSV、Word、Excel、RTF、Flash、ODT 和 ODS。

    JasperServer 允许通过 Web 界面访问 JasperReports 中内置的报告功能。红帽企业虚拟化提供了一个自定义的 JasperServer 实施，它包括一系列预先设定的报告和仪表板，并提供了创建特别报告的能力。

    要访问报告引擎，请使用新版本的浏览器（比如 Firefox 或 Internet Explorer）来访问以下 URL：https://rhev-m.host.fqdn/ovirt-engine--reports（主页上的报告门户链接）。提示登录时，输入执行 engine-setup 命令执行时分配给报告管理员帐户的用户名 admin 和密码。报告用户账户与管理管理程序主机和虚拟机的 RHEV 用户更为不同。登录报告引擎 Web 界面后，可创建并管理用户，方法是将鼠标悬停在管理选项卡上，然后选择 “用户” 菜单项。有两个可以分配给报告用户的用户角色：ROLE_USER 和 ROLE_ADMINISTRATOR。带有 ROLE_USER 的角色可访问标准报告和控制面板，并创建特别报告。带有 ROLE_ADMINISTRATOR 的角色可额外创建并管理标准报告。

###### 存储库

查看可用报告的简单方法是使用存储库。要查看存储库中可用的预定义报告，请导航至顶部导航栏中的视图并选择存储库。扩展 RHEVM 报告文件，查看可用菜单。当前菜单包括：

*    Ad Hoc 组件
*    控制面板
*    报告
*    资源

Ad Hoc 组件菜单列示了用作自定义报告基础的域和主题。

控制面板菜单列出能够提供系统状态的高级执行视图的报告。通常，每个控制面板都是一个报告集合，使多种信息显示在某个单一屏幕上。只能在屏幕上查看控制面板。不能使用导出报告的方式导出一系列的输出格式。

报告菜单包含一些子菜单，其中包括以下选项：

*    执行
*    库存
*    服务级别
*    趋势

执行子菜单包括可有助于容量规划的系统状态的高级别概述。库存子菜单报告会列出当前系统资源，包括物理主机、存储域和虚拟机。服务级别子菜单中的报告显示有关系统性能和在用户定义阈值之内的可用性。最后，趋势子菜单中的报告会突出系统应用和可用性方面的更改，这有助于在系统中找出问题和瓶颈以及规划容量扩展。

资源菜单包括不能被修改的系统配置和资源。其他三种选择对于报告的生成更有帮助。

要创建自定义报告，将鼠标悬停在创建选项卡上方并从出现的弹出菜单中选择 Ad Hoc 视图。选择主题或者域选项卡，以确定要在报告中显示的通用信息类型。可通过单击选择树下面的表格、图表或交叉表来选择报告形状。选择对应的选项，以打开将用于创建报告的编辑器。 

###### 练习：生成报告

1. 在 workstation 上，启动 Firefox Web 浏览器。转至以下链接：https://rhevm.podX.example.com/ovirt-engine-reports。使用用户 ID admin 和密码 redhat 进行验证。
2. 在顶部导航栏中，选择视图菜单，并在弹出菜单中选择存储库以打开存储库。
3. 在左侧窗格中打开 RHEVM 报告文件夹并在面板树中选择系统概述面板。预览显示在系统面板上的信息。完成后，导航至顶部导航栏中的库菜单项。
4. 选择主机库存 (BR1) 报告。将数据中心更改为活动数据中心 testdcX，然后单击确定，而其他报告参数保留默认值，以显示 RHEV-H 主机的列表。完成后，导航至顶部导航栏中的库菜单项。
5. 选择虚拟机库存 (BR9) 链接。确保数据中心设置为活动数据中心 testdcX，然后单击确定，而其他报告参数保留默认值，以显示虚拟机的列表。将鼠标悬停在保存按钮右侧的导出图标上。从下拉菜单中选择 导出为 PDF ，以将 PDF 报告另存为文件并通过浏览器进行查看。

###### 实验：使用特别报告 (Ad Hoc Report) 功能监控和报告 RHEV

成果. 您应该能够生成名为 Custom RH318 Report 的自定义报告，其中显示虚拟机属性的列表。

实验大纲： 创建显示当前虚拟机配置信息列表的称为 Custom RH318 Report 的自定义报告。它应该有五列，包含以下数据和标题：

*    列标题	    要显示的数据
*    名称	    虚拟机的 RHEV-M 名称
*    描述	    显示在虚拟机常规选项卡中描述字段里的长名称
*    虚拟机类型	虚拟机类型，如服务器或桌面
*    创建日期	    创建虚拟机的日期
*    更新日期	    虚拟机的上一次更改日期

显示在报告顶端的标题应阅读“自定义 RH318 报告”。

1. 登录报告引擎 (Report Engine)

    在 rhevm 上，启动 Firefox Web 浏览器。转至以下链接：https://rhevm.podX.example.com/ovirt-engine-reports。使用用户 ID admin 和密码 redhat 进行验证。 

2. 创建报告

*    将鼠标指针悬停在创建选项卡上方并从下拉菜单中选择 “Ad Hoc 视图” 。
*    选择主题选项卡，然后展开 Ad Hoc 组件文件夹，再展开主题文件夹，最后展开 3.1（没错，是 3.1）文件夹。选择虚拟机库存（特别报告）主题并单击表格按钮。 

3. 添加列

展开左边框中的虚拟机文件。将以下项从左边框拖放到报告正文（按照以下顺序）：

*    虚拟机名称
*    虚拟机描述
*    虚拟机类型
*    虚拟机创建日期
*    虚拟机更新日期
    
4. 调整列标题

更改列的标题。例如，右键单击虚拟机名称列并从菜单中选择 “编辑标签” 。在文本框中键入名称。将相关字段的标题更改为以下值：

*    “名称”
*    “描述”
*    “类型”
*    “创建日期”
*    “更新日期”

5. 调整报告标题

单击单击添加标题字段并键入 Custom RH318 Report。

6. 保存报告定义

将鼠标指针放在软盘图标上方，并从下拉菜单中选择 保存 Ad Hoc 视图并创建报告 。在出现的对话框中，在数据视图名称（必填）：文本框中键入 Custom RH318 Report，并在数据视图描述：文本框中键入一些描述性文本。在树视图中，展开 RHEVM 报告，再展开报告，然后选择库存。单击保存，以创建自定义报告并保存 ad hoc 视图。 

7. 测试新报告

将鼠标指针悬停在视图选项卡上方并导航至存储库。在 RHEVM 报告、报告、库存或顶部面板上的库选项卡中查找新的自定义报告。 

