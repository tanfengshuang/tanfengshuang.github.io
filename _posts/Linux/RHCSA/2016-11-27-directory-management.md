---
layout: post
title:  "目录管理"
categories: Linux
tags: RHCSA setuid setgid sticky umask
---

关于linux的基本命令的详细使用可以通过网站 [http://man.linuxde.net/](http://man.linuxde.net/)查看

Linux常见的系统目录：
*    /bin: 存储常用用户指令
*    /root: 存储核心， 模块映像等启动文件
*    /dev: 存储设备文件
*    /etc: 存储系统 服务的配置目录与文件
*    /home: 存放个人主目录
*    /lib: 存放库文件，诸如核心模块 驱动
*    /lost+found: 存储fsck用的孤儿文件
*    /mnt: 系统加载文件系统时用的常用挂载点
*    /opt: 第三方工具使用的安装目录
*    /proc: 虚拟文件系统，包含系统核心信息
*    /root: root用户的主目录
*    /sbin: 存储系统管理的指令
*    /tmp: 临时文件的暂存点
*    /usr: 存放与用户直接相关的文件与目录
*    /var: 存储在系统运行中可能会更改的数据

强制位与冒险位

在Linux系统中文件除了有读写执行的权限外，ext2文件系统还支持强制位(setuid, setgid)与冒险位(sticky)的特殊权限。

*    针对文件常见者可以添加强制位(setuid)
*    文件属组也可以添加强制位(setgid)
*    针对其他用户可以添加冒险位(sticky)

强制位和冒险位添加在执行权限(x)的位置上，如果该位置上原已有执行权限，则强制位和冒险位以小写字母(s或t)的方式表示，否则，一大写字母(S或T)表示。
例如，如果文件的权限为"rwxr--r-x"，如果设置了强制位和冒险位则"rwsr-Sr-t"

### 对创建者设置强制位

对创建者设置强制位setuid, 一般针对的是一个系统中的指令
在默认情况下，用户执行一个指令，会以该用户的身份来允许, 但是当对一个指令对应的可执行文件设置了(setuid), 那么任何一个用户在执行这个文件的时候，都会以指令对应的可执行文件的创建者身份(即属主身份)来执行这个文件

> chmod u+s <文件名>

> chmod u-s <文件名>

例如, 命令passwd，属主是root，正常来说只有root才能执行passwd命令，但是实际上其他普通用户也可以执行passwd命令，因为设置了强制位后，当普通用户执行passwd命令时临时会拥有属主root的权限

```
# ll `which passwd`
-rwsr-xr-x. 1 root root 27872 Feb  5  2016 /usr/bin/passwd
```

### 对组设置强制位

对组设置强制位setgid, 一般针对的是一个目录
在默认情况下，用户在某目录中创建的文件或子目录的属组是该用户的主属组，但是如果对一个目录设置了属组的强制位，则任何用户在此目录中创建的文件或子目录都会继承此目录的属组(前提：用户有权限在目录中创建文件或子目录)

> chmod g+s <目录>
> chmod g-s <目录>

### 对其他用户设置冒险位

对其他用户设置冒险位sticky,一般针对的是一个目录
在默认情况下,如果一个目录对用户有rwx权限,则这个用户可以在此目录中建立与删除任何文件, 一旦在目录上设置了冒险位,则表示在此目录中,只有文件的拥有者和系统管理员才可以在目录中删除此文件

### 通过数字来设置权限

强制位和冒险位可以通过一个数字加和,放在读写执行的三位数字前来指定

*    4(setuid)
*    2(setgid)
*    1(sticky)

例如, "rwsr-xr-x" -> chmod 4755

例如,/tmp是系统的临时文件目录，所有的用户在该目录下拥有所有的权限，也就是说在该目录下可以任意创建、修改、删除文件，那如果用户A在该目录下创建了一个文件，用户B将该文件删除了，这种情况我们是不能允许的。为了达到该目的，就出现了stick bit（粘滞位）的概念。它是针对目录来说的，如果该目录设置了stick bit（粘滞位），则该目录下的文件除了该文件的创建者和root用户可以删除和修改/tmp目录下的stuff，别的用户均不能动别人的，这就是粘滞位的作用

### umask掩码

每个用户建立文件时,此文件都会有默认权限.
默认权限的值由环境中的umask值与文件和目录的基数来确定
用户可以自主改动umask值,并在改后马上生效
一般用户的默认umask值为002,系统用户的默认umask值为022
文件的基数:666
目录的基数: 777
	
```
# umask 0022
# umask 0777
```

